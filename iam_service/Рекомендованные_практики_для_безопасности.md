# Рекомендованные практики для безопасности и работы с токенами

1. **Использование HTTPS**
   - Все коммуникации между клиентом и сервером должны происходить по HTTPS, чтобы защитить данные от атак типа "человек посередине" (MITM).

2. **Использование JWT токенов**
   - **Access токены**: Краткоживущие (например, 15 минут) для аутентификации.
   - **Refresh токены**: Долгоживущие (например, 7 дней) для обновления Access токенов.
   - Подписывайте токены надежным алгоритмом (например, HS256 или RS256).
   - Шифруйте содержимое токенов при необходимости для дополнительной безопасности.

3. **Хранение токенов**
   - Access и Refresh токены должны храниться в куках с атрибутами `HttpOnly`, `Secure` и `SameSite=Strict`.
     - **HttpOnly**: Защищает токены от доступа через JavaScript.
     - **Secure**: Токены отправляются только по HTTPS.
     - **SameSite=Strict**: Ограничивает использование токенов только в пределах одного домена, снижая риск CSRF атак.

4. **CSRF защита**
   - Используйте CSRF токены для каждого запроса, передавая их через заголовки (например, `X-CSRF-Token`).
   - Проверьте, что токен в запросе соответствует тому, что хранится в сессии или куки.

5. **Обновление Access токенов**
   - Обрабатывайте истекшие Access токены на сервере.
   - При получении ошибки 401 Unauthorized клиент отправляет запрос на обновление токена с использованием Refresh токена.

6. **Атрибуты куков**
   - **HttpOnly**: Защита от XSS.
   - **Secure**: Гарантия использования только по HTTPS.
   - **SameSite=Strict**: Отключает доступ из других доменов, снижая риск CSRF атак.

7. **Обработка ошибок и выход из системы**
   - Обработка ошибок авторизации на клиенте: при получении ошибки 401 или 403 клиент должен автоматически инициировать процесс обновления токена или перенаправлять пользователя на страницу входа.
   - При выходе из системы сервер должен удалять все токены (Access и Refresh) из куков и сессии.

8. **Ограничение частоты запросов и защита от атак типа brute force**
   - Внедрите механизмы rate limiting для ограничения частоты запросов от одного клиента.
   - Логируйте все попытки входа и обновления токенов для выявления подозрительной активности.

9. **Content Security Policy (CSP)**
   - Настройте строгую политику CSP для защиты от XSS атак, ограничив допустимые источники загрузки контента.
     - Пример:
       ```http
       Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted-scripts.com; style-src 'self';
       ```

10. **Subresource Integrity (SRI)**
    - Используйте SRI для проверки целостности загружаемых ресурсов (например, скриптов и стилей), чтобы предотвратить атаки с подменой.

11. **Безопасность API**
    - Настройте CORS, чтобы разрешать запросы только с доверенных доменов.
    - Внедрите дополнительные заголовки безопасности:
      - **Strict-Transport-Security (HSTS)**: Обеспечивает, что сайт всегда доступен через HTTPS.
      - **X-Frame-Options**: Защищает от Clickjacking.
      - **X-Content-Type-Options**: Предотвращает интерпретацию файлов как других типов.
      - **Referrer-Policy**: Управляет отправкой заголовка `Referer`.
      - **Permissions-Policy**: Управляет доступом к функционалу браузера (например, камера, микрофон и геолокация).

12. **Многофакторная Аутентификация (MFA)**
    - Используйте MFA для повышения уровня безопасности, особенно для критических операций (например, изменение настроек аккаунта или доступ к чувствительным данным).

13. **Использование короткоживущих Access токенов и Long Polling / WebSockets**
    - Сократите время жизни Access токенов до 5 минут или меньше, если это соответствует архитектуре приложения.
    - При использовании WebSockets убедитесь, что аутентификация происходит регулярно с актуальными токенами.

14. **IP Whitelisting / Blacklisting**
    - Ограничьте доступ к критически важным частям вашего API с помощью белого списка IP-адресов или внедрите черный список для блокировки подозрительных адресов.

15. **Защита от Replay Attack**
    - Внедрите защиту от атак повторов (Replay Attack) с помощью nonce или timestamp механизма.

16. **OAuth 2.0 Best Practices**
    - Если вы используете OAuth 2.0, следуйте рекомендациям по безопасной реализации, таким как PKCE (Proof Key for Code Exchange) для мобильных и публичных клиентов.
    - Используйте scopes для минимизации рисков компрометации.

17. **Блокировка аккаунта после нескольких неудачных попыток входа**
    - Внедрите блокировку аккаунта или временную задержку после нескольких неудачных попыток входа для защиты от brute force атак.

18. **Шифрование данных на клиенте**
    - Добавьте шифрование на стороне клиента для защиты конфиденциальной информации.

19. **Регулярные тесты безопасности и пентесты**
    - Проводите регулярные тесты безопасности и тесты на проникновение для поиска уязвимостей.

20. **Логирование безопасности и мониторинг**
    - Централизованное логирование всех действий, связанных с аутентификацией и токенами, для мониторинга подозрительной активности и быстрого реагирования на инциденты безопасности.
